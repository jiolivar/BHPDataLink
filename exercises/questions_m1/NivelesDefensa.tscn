[gd_scene load_steps=20 format=2]

[ext_resource path="res://game/main_screens/question_templates/drag_image.tscn" type="PackedScene" id=1]
[ext_resource path="res://game/main_screens/question_templates/Elements/drop_zone.tscn" type="PackedScene" id=2]
[ext_resource path="res://game/main_screens/question_templates/Elements/dragable_element.tscn" type="PackedScene" id=3]
[ext_resource path="res://game/components/help/cursor_help.tscn" type="PackedScene" id=4]
[ext_resource path="res://assets/images/img_op1.png" type="Texture" id=5]
[ext_resource path="res://assets/images/img_op3.png" type="Texture" id=6]
[ext_resource path="res://assets/images/img_op2.png" type="Texture" id=7]

[sub_resource type="RectangleShape2D" id=1]
resource_local_to_scene = true
extents = Vector2( 98, 84 )

[sub_resource type="StyleBoxFlat" id=16]
resource_local_to_scene = true
bg_color = Color( 0.6, 0.6, 0.6, 0 )
border_width_left = 2
border_width_top = 2
border_width_right = 2
border_width_bottom = 2
border_color = Color( 0.227451, 0.878431, 1, 1 )
corner_radius_top_left = 10
corner_radius_top_right = 10
corner_radius_bottom_right = 10
corner_radius_bottom_left = 10

[sub_resource type="StyleBoxFlat" id=17]
resource_local_to_scene = true
bg_color = Color( 0.6, 0.6, 0.6, 0 )
border_width_left = 2
border_width_top = 2
border_width_right = 2
border_width_bottom = 2
border_color = Color( 0.227451, 0.878431, 1, 1 )
corner_radius_top_left = 10
corner_radius_top_right = 10
corner_radius_bottom_right = 10
corner_radius_bottom_left = 10

[sub_resource type="StyleBoxFlat" id=18]
resource_local_to_scene = true
bg_color = Color( 0.6, 0.6, 0.6, 0 )
border_width_left = 2
border_width_top = 2
border_width_right = 2
border_width_bottom = 2
border_color = Color( 0.227451, 0.878431, 1, 1 )
corner_radius_top_left = 10
corner_radius_top_right = 10
corner_radius_bottom_right = 10
corner_radius_bottom_left = 10

[sub_resource type="RectangleShape2D" id=5]
resource_local_to_scene = true
extents = Vector2( 46.69, 61.54 )

[sub_resource type="Shader" id=6]
code = "shader_type canvas_item;
uniform float width = 2.0;
uniform vec4 color: hint_color;

void vertex() {
	VERTEX += (UV * 2.0 - 1.0) * width;
}

void fragment(){
	vec2 uv = UV;
    vec4 col;
	
	vec2 texture_pixel_size = vec2(1.0) / (vec2(1.0) / TEXTURE_PIXEL_SIZE + vec2(width * 2.0));
	uv = (uv - texture_pixel_size * width) * TEXTURE_PIXEL_SIZE / texture_pixel_size;
	if (uv != clamp(uv, vec2(0.0), vec2(1.0))) {
		COLOR.a = 0.0;
	} else {
		col = texture(TEXTURE, uv);
	}
	
	
    vec2 ps = TEXTURE_PIXEL_SIZE * width; // multiply only once instead of eight times.
    float a;
    float maxa = col.a;
    float mina = col.a;

    // Use 8-way kernel for smoothness
    //------------------//
    //    X   X   X     //
    //      \\ | /       //
    //    X - O - X     //
    //      / | \\       //
    //    X   X   X     //
    //------------------//

    for(float y = -1.0; y <= 1.0; y++) {
        for(float x = -1.0; x <= 1.0; x++) {
            if(vec2(x,y) == vec2(0.0)) {
                continue; // ignore the center of kernel
            }

            a = texture(TEXTURE, UV + vec2(x,y)*ps).a;
            maxa = max(a, maxa); 
            mina = min(a, mina);
        }
    }

    // Fill transparent pixels only, don't overlap texture
    if(col.a == 0.0) {
        COLOR = mix(col, color, maxa-mina);
    } else {
        // Note on old code: if the last mix value is always 0, why even use it?
        COLOR = col;
    }
}"

[sub_resource type="ShaderMaterial" id=7]
resource_local_to_scene = true
shader = SubResource( 6 )
shader_param/width = 0.0
shader_param/color = null

[sub_resource type="RectangleShape2D" id=8]
resource_local_to_scene = true
extents = Vector2( 45.92, 65.72 )

[sub_resource type="ShaderMaterial" id=9]
resource_local_to_scene = true
shader = SubResource( 6 )
shader_param/width = 0.0
shader_param/color = null

[sub_resource type="RectangleShape2D" id=10]
resource_local_to_scene = true
extents = Vector2( 44.4, 66.5 )

[sub_resource type="Shader" id=15]
code = "shader_type canvas_item;
uniform float width = 2.0;
uniform vec4 color: hint_color;

void vertex() {
	VERTEX += (UV * 2.0 - 1.0) * width;
}

void fragment(){
	vec2 uv = UV;
    vec4 col;
	
	vec2 texture_pixel_size = vec2(1.0) / (vec2(1.0) / TEXTURE_PIXEL_SIZE + vec2(width * 2.0));
	uv = (uv - texture_pixel_size * width) * TEXTURE_PIXEL_SIZE / texture_pixel_size;
	if (uv != clamp(uv, vec2(0.0), vec2(1.0))) {
		COLOR.a = 0.0;
	} else {
		col = texture(TEXTURE, uv);
	}
	
	
    vec2 ps = TEXTURE_PIXEL_SIZE * width; // multiply only once instead of eight times.
    float a;
    float maxa = col.a;
    float mina = col.a;

    // Use 8-way kernel for smoothness
    //------------------//
    //    X   X   X     //
    //      \\ | /       //
    //    X - O - X     //
    //      / | \\       //
    //    X   X   X     //
    //------------------//

    for(float y = -1.0; y <= 1.0; y++) {
        for(float x = -1.0; x <= 1.0; x++) {
            if(vec2(x,y) == vec2(0.0)) {
                continue; // ignore the center of kernel
            }

            a = texture(TEXTURE, UV + vec2(x,y)*ps).a;
            maxa = max(a, maxa); 
            mina = min(a, mina);
        }
    }

    // Fill transparent pixels only, don't overlap texture
    if(col.a == 0.0) {
        COLOR = mix(col, color, maxa-mina);
    } else {
        // Note on old code: if the last mix value is always 0, why even use it?
        COLOR = col;
    }
}"

[sub_resource type="ShaderMaterial" id=11]
resource_local_to_scene = true
shader = SubResource( 15 )
shader_param/width = 0.0
shader_param/color = null

[node name="NivelesDefensa" instance=ExtResource( 1 )]
title = "Niveles de defensa"
question = "Optalert ofrece 3 niveles de defensa. Arrastre las im치genes que representan a los niveles donde correspondan."

[node name="Title" parent="Panel" index="0"]
text = "Niveles de defensa"

[node name="Question" parent="Panel" index="2"]
text = "Optalert ofrece 3 niveles de defensa. Arrastre las im치genes que representan a los niveles donde correspondan."

[node name="DropZone" parent="Zones" index="0" instance=ExtResource( 2 )]
position = Vector2( 337, -13 )
id = 2
text = "Segundo nivel"

[node name="CollisionShape2D" parent="Zones/DropZone" index="0"]
shape = SubResource( 1 )

[node name="HighLite" parent="Zones/DropZone" index="1"]
margin_left = -98.0
margin_top = -84.0
margin_right = 98.0
margin_bottom = 84.0
custom_styles/panel = SubResource( 16 )

[node name="Label" parent="Zones/DropZone/HighLite" index="0"]
margin_left = -85.0
margin_right = 85.0
margin_bottom = 34.0
text = "Segundo nivel"

[node name="DropZone15" parent="Zones" index="1" instance=ExtResource( 2 )]
position = Vector2( 118, -13 )
id = 1
text = "Primer nivel"

[node name="CollisionShape2D" parent="Zones/DropZone15" index="0"]
shape = SubResource( 1 )

[node name="HighLite" parent="Zones/DropZone15" index="1"]
margin_left = -98.0
margin_top = -84.0
margin_right = 98.0
margin_bottom = 84.0
custom_styles/panel = SubResource( 17 )

[node name="Label" parent="Zones/DropZone15/HighLite" index="0"]
margin_left = -78.0
margin_right = 78.0
margin_bottom = 34.0
text = "Primer nivel"

[node name="DropZone16" parent="Zones" index="2" instance=ExtResource( 2 )]
position = Vector2( 221, 173 )
id = 3
text = "Tercer nivel"

[node name="CollisionShape2D" parent="Zones/DropZone16" index="0"]
shape = SubResource( 1 )

[node name="HighLite" parent="Zones/DropZone16" index="1"]
margin_left = -98.0
margin_top = -84.0
margin_right = 98.0
margin_bottom = 84.0
custom_styles/panel = SubResource( 18 )

[node name="Label" parent="Zones/DropZone16/HighLite" index="0"]
margin_left = -82.0
margin_right = 82.0
margin_bottom = 34.0
text = "Tercer nivel"

[node name="DragableElement2" parent="CorrectElements" index="0" instance=ExtResource( 3 )]
position = Vector2( -215, 167 )
id = 1
text = "Operadores"
image = ExtResource( 5 )
image_scale = 0.22

[node name="CollisionShape2D" parent="CorrectElements/DragableElement2" index="0"]
shape = SubResource( 5 )

[node name="Label" parent="CorrectElements/DragableElement2" index="1"]
margin_left = -44.0
margin_top = 65.0
margin_right = 44.0
margin_bottom = 79.0
text = "Operadores"

[node name="Icon" parent="CorrectElements/DragableElement2" index="2"]
material = SubResource( 7 )
scale = Vector2( 0.22, 0.22 )
texture = ExtResource( 5 )

[node name="HighLite" parent="CorrectElements/DragableElement2" index="6"]
margin_right = 66.0

[node name="DragableElement5" parent="CorrectElements" index="1" instance=ExtResource( 3 )]
position = Vector2( -116, 0 )
id = 3
text = "Mitigaci칩n de riesgo"
image = ExtResource( 6 )
image_scale = 0.22

[node name="CollisionShape2D" parent="CorrectElements/DragableElement5" index="0"]
shape = SubResource( 8 )

[node name="Label" parent="CorrectElements/DragableElement5" index="1"]
margin_left = -77.0
margin_top = 63.0
margin_right = 75.0
margin_bottom = 77.0
text = "Mitigaci칩n de riesgo"

[node name="Icon" parent="CorrectElements/DragableElement5" index="2"]
material = SubResource( 9 )
scale = Vector2( 0.22, 0.22 )
texture = ExtResource( 6 )

[node name="DragableElement10" parent="CorrectElements" index="2" instance=ExtResource( 3 )]
position = Vector2( -315, -2 )
id = 2
text = "Monitoreo en tiempo real"
image = ExtResource( 7 )
image_scale = 0.2

[node name="CollisionShape2D" parent="CorrectElements/DragableElement10" index="0"]
shape = SubResource( 10 )

[node name="Label" parent="CorrectElements/DragableElement10" index="1"]
margin_left = -93.0
margin_top = 65.0
margin_right = 97.0
margin_bottom = 79.0
text = "Monitoreo en tiempo real"

[node name="Icon" parent="CorrectElements/DragableElement10" index="2"]
material = SubResource( 11 )
scale = Vector2( 0.2, 0.2 )
texture = ExtResource( 7 )

[node name="PopUp" parent="." index="7"]
text = "Efectivamente, existen diferentes roles que utilizan cada nivel del sistema Optalert."

[node name="CursorHelp" parent="." index="9" instance=ExtResource( 4 )]
margin_left = -133.5
margin_top = -35.0
margin_right = -72.4999
margin_bottom = 29.0

[node name="Target" parent="CursorHelp" index="2"]
margin_left = 203.5
margin_top = 0.0
margin_right = 243.5
margin_bottom = 40.0

[connection signal="dragged" from="CorrectElements/DragableElement2" to="." method="_on_DragableElement2_dragged"]
[connection signal="dragged" from="CorrectElements/DragableElement5" to="." method="_on_DragableElement5_dragged"]
[connection signal="dragged" from="CorrectElements/DragableElement10" to="." method="_on_DragableElement10_dragged"]

[editable path="Zones/DropZone"]
[editable path="Zones/DropZone15"]
[editable path="Zones/DropZone16"]
[editable path="CorrectElements/DragableElement2"]
[editable path="CorrectElements/DragableElement5"]
[editable path="CorrectElements/DragableElement10"]
[editable path="CursorHelp"]
